<!DOCTYPE html>
<html>
<head>
    <title>Clear Auth Issues</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .success { color: green; font-weight: bold; }
        .info { background: #e7f3ff; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .warning { background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #ffc107; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>
        
        <div class="warning">
            <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –µ—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
        </div>

        <h3>–®–∞–≥ 1: –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤</h3>
        <button onclick="clearAllFlags()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–ª–∞–≥–∏</button>
        <div id="clearResult"></div>

        <h3>–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è</h3>
        <button onclick="checkCurrentState()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
        <div id="stateResult"></div>

        <h3>–®–∞–≥ 3: –¢–µ—Å—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</h3>
        <button onclick="testNavigation()">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ /auth</button>
        <div id="navResult"></div>

        <div class="info">
            <strong>–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:</strong>
            <ol>
                <li>–ù–∞–∂–º–∏—Ç–µ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–ª–∞–≥–∏"</li>
                <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</li>
                <li>–ó–∞–∫—Ä–æ–π—Ç–µ —ç—Ç—É –≤–∫–ª–∞–¥–∫—É</li>
                <li>–û–±–Ω–æ–≤–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (F5)</li>
                <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ —Å–Ω–æ–≤–∞</li>
            </ol>
        </div>
    </div>

    <script>
        function clearAllFlags() {
            const result = document.getElementById('clearResult');
            
            try {
                // –û—á–∏—â–∞–µ–º –≤—Å–µ logout —Ñ–ª–∞–≥–∏
                localStorage.removeItem('logout_in_progress');
                localStorage.removeItem('last_logout_time');
                
                // –û—á–∏—â–∞–µ–º –¥—Ä—É–≥–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–ª–∞–≥–∏
                localStorage.removeItem('auth_blocked');
                localStorage.removeItem('session_error');
                
                // –û—á–∏—â–∞–µ–º sessionStorage —Ç–æ–∂–µ
                sessionStorage.clear();
                
                result.innerHTML = '<div class="success">‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–ª–∞–≥–∏ –æ—á–∏—â–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!</div>';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –±—ã–ª–æ –æ—á–∏—â–µ–Ω–æ
                const cleared = [
                    'logout_in_progress',
                    'last_logout_time',
                    'auth_blocked', 
                    'session_error',
                    'sessionStorage (–ø–æ–ª–Ω–æ—Å—Ç—å—é)'
                ];
                
                result.innerHTML += '<pre>–û—á–∏—â–µ–Ω–æ:\n' + cleared.join('\n') + '</pre>';
                
            } catch (error) {
                result.innerHTML = '<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ: ' + error.message + '</div>';
            }
        }

        function checkCurrentState() {
            const result = document.getElementById('stateResult');
            
            try {
                const state = {
                    'logout_in_progress': localStorage.getItem('logout_in_progress'),
                    'last_logout_time': localStorage.getItem('last_logout_time'),
                    'session cookie': document.cookie.includes('session'),
                    'localStorage keys': Object.keys(localStorage).length,
                    'sessionStorage keys': Object.keys(sessionStorage).length
                };
                
                let html = '<h4>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</h4><pre>';
                for (const [key, value] of Object.entries(state)) {
                    html += key + ': ' + (value || '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω') + '\n';
                }
                html += '</pre>';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é isAuthBlocked –µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
                html += '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</h4>';
                const logoutInProgress = localStorage.getItem('logout_in_progress');
                const lastLogoutTime = localStorage.getItem('last_logout_time');
                
                let isBlocked = false;
                let blockReason = '';
                
                if (logoutInProgress === 'true') {
                    isBlocked = true;
                    blockReason = 'logout_in_progress —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                } else if (lastLogoutTime) {
                    const logoutTime = parseInt(lastLogoutTime);
                    const timeSinceLogout = Date.now() - logoutTime;
                    if (timeSinceLogout < 5000) {
                        isBlocked = true;
                        blockReason = `–Ω–µ–¥–∞–≤–Ω–∏–π logout (${timeSinceLogout}ms –Ω–∞–∑–∞–¥)`;
                    }
                }
                
                html += '<pre>';
                html += '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞: ' + (isBlocked ? '–î–ê' : '–ù–ï–¢') + '\n';
                if (isBlocked) {
                    html += '–ü—Ä–∏—á–∏–Ω–∞: ' + blockReason + '\n';
                }
                html += '</pre>';
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = '<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ' + error.message + '</div>';
            }
        }

        function testNavigation() {
            const result = document.getElementById('navResult');
            
            result.innerHTML = '<div>üß™ –¢–µ—Å—Ç–∏—Ä—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é...</div>';
            
            setTimeout(() => {
                try {
                    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–∞–º–º–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
                    const testUrl = window.location.origin + '/auth';
                    result.innerHTML = `
                        <div class="success">‚úÖ –¢–µ—Å—Ç –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É</div>
                        <p><strong>–°—Å—ã–ª–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong></p>
                        <p><a href="${testUrl}" target="_blank">${testUrl}</a></p>
                        <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤—ã—à–µ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ.</p>
                    `;
                } catch (error) {
                    result.innerHTML = '<div style="color: red;">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</div>';
                }
            }, 500);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkCurrentState();
        }
    </script>
</body>
</html> 